(function(V){var E=V.fn.domManip,S="_tmplitem",F=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,U={},Q={},R,G={key:0,data:{}},O=0,T=0,K=[];function P(f,h,b,a){var j={data:a||(h?h.data:{}),_wrap:h?h._wrap:null,tmpl:null,parent:h||null,nodes:[],calls:B,nest:z,wrap:y,html:A,update:C};f&&V.extend(j,f,{nodes:[],parent:h});if(b){j.tmpl=b;j._ctnt=j._ctnt||j.tmpl(V,j);j.key=++O;(K.length?Q:U)[O]=j;}return j;}V.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){V.fn[a]=function(r){var q=[],o=V(r),e,p,c,d,f=this.length===1&&this[0].parentNode;R=U||{};if(f&&f.nodeType===11&&f.childNodes.length===1&&o.length===1){o[b](this[0]);q=this;}else{for(p=0,c=o.length;p<c;p++){T=p;e=(p>0?this.clone(true):this).get();V.fn[b].apply(V(o[p]),e);q=q.concat(e);}T=0;q=this.pushStack(q,a,o.selector);}d=R;R=null;V.tmpl.complete(d);return q;};});V.fn.extend({tmpl:function(e,f,a){return V.tmpl(this[0],e,f,a);},tmplItem:function(){return V.tmplItem(this[0]);},template:function(a){return V.template(a,this[0]);},domManip:function(n,a,b){if(n[0]&&n[0].nodeType){var m=V.makeArray(arguments),k=n.length,c=0,e;while(c<k&&!(e=V.data(n[c++],"tmplItem"))){}if(k>1){m[0]=[V.makeArray(n)];}if(e&&T){m[2]=function(d){V.tmpl.afterManip(this,d,b);};}E.apply(this,m);}else{E.apply(this,arguments);}T=0;!R&&V.tmpl.complete(U);return this;}});V.extend({tmpl:function(i,f,g,l){var b,a=!l;if(a){l=G;i=V.template[i]||V.template(null,i);Q={};}else{if(!i){i=l.tmpl;U[l.key]=l;l.nodes=[];l.wrapped&&I(l,l.wrapped);return V(N(l,null,l.tmpl(V,l)));}}if(!i){return[];}if(typeof f==="function"){f=f.call(l||{});}g&&g.wrapped&&I(g,g.wrapped);b=V.isArray(f)?V.map(f,function(c){return c?P(g,l,i,c):null;}):[P(g,l,i,f)];return a?V(N(l,null,b)):b;},tmplItem:function(a){var d;if(a instanceof V){a=a[0];}while(a&&a.nodeType===1&&!(d=V.data(a,"tmplItem"))&&(a=a.parentNode)){}return d||G;},template:function(d,a){if(a){if(typeof a==="string"){a=H(a);}else{if(a instanceof V){a=a[0]||{};}}if(a.nodeType){a=V.data(a,"tmpl")||V.data(a,"tmpl",H(a.innerHTML));}return typeof d==="string"?(V.template[d]=a):a;}return d?typeof d!=="string"?V.template(null,d):V.template[d]||V.template(null,F.test(d)?d:V(d)):null;},encode:function(b){return(""+b).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;");}});V.extend(V.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){U={};},afterManip:function(c,a,h){var g=a.nodeType===11?V.makeArray(a.childNodes):a.nodeType===1?[a]:[];h.call(c,a);J(g);T++;}});function N(i,d,h){var a,j=h?V.map(h,function(b){return typeof b==="string"?i.key?b.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+S+'="'+i.key+'" $2'):b:N(b,i,b._ctnt);}):i;if(d){return j;}j=j.join("");j.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(b,l,g,k){a=V(g).get();J(a);if(l){a=M(l).concat(a);}if(k){a=a.concat(M(k));}});return a?a:M(j);}function M(d){var a=document.createElement("div");a.innerHTML=d;return V.makeArray(a.childNodes);}function H(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+V.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(k,n,o,u,w,v,t){var p=V.tmpl.tag[o],q,s,r;if(!p){throw"Template command not found: "+o;}q=p._default||[];if(v&&!/\w$/.test(w)){w+=v;v="";}if(w){w=L(w);t=t?","+L(t)+")":v?")":"";s=v?w.indexOf(".")>-1?w+v:"("+w+").call($item"+t:w;r=v?s:"(typeof("+w+")==='function'?("+w+").call($item):("+w+"))";}else{r=s=q.$1||"null";}u=L(u);return"');"+p[n?"close":"open"].split("$notnull_1").join(w?"typeof("+w+")!=='undefined' && ("+w+")!=null":"true").split("$1a").join(r).split("$1").join(s).split("$2").join(u?u.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(g,h,e,f){f=f?","+f+")":e?")":"";return f?"("+h+").call($item"+f:g;}):q.$2||"")+"_.push('";})+"');}return _;");}function I(d,a){d._wrap=N(d,true,V.isArray(a)?a:[F.test(a)?a:V(a).html()]).join("");}function L(b){return b?b.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null;}function D(c){var d=document.createElement("div");d.appendChild(c.cloneNode(true));return d.innerHTML;}function J(b){var c="_"+T,g,h,f={},r,a,q;for(r=0,a=b.length;r<a;r++){if((g=b[r]).nodeType!==1){continue;}h=g.getElementsByTagName("*");for(q=h.length-1;q>=0;q--){d(h[q]);}d(g);}function d(s){var v,t=s,n,u,l;if(l=s.getAttribute(S)){while(t.parentNode&&(t=t.parentNode).nodeType===1&&!(v=t.getAttribute(S))){}if(v!==l){t=t.parentNode?t.nodeType===11?0:t.getAttribute(S)||0:0;if(!(u=U[l])){u=Q[l];u=P(u,U[t]||Q[t],null,true);u.key=++O;U[O]=u;}T&&w(l);}s.removeAttribute(S);}else{if(T&&(u=V.data(s,"tmplItem"))){w(u.key);U[u.key]=u;t=V.data(s.parentNode,"tmplItem");t=t?t.key:0;}}if(u){n=u;while(n&&n.key!=t){n.nodes.push(s);n=n.parent;}delete u._ctnt;delete u._wrap;V.data(s,"tmplItem",u);}function w(e){e=e+c;u=f[e]=f[e]||P(u,U[u.parent.key+c]||u.parent,null,true);}}}function B(f,g,h,e){if(!f){return K.pop();}K.push({_:f,tmpl:g,item:this,data:h,options:e});}function z(e,f,a){return V.tmpl(V.template(e),f,a,this);}function y(a,e){var f=a.options||{};f.wrapped=e;return V.tmpl(V.template(a.tmpl),a.data,f,a.item);}function A(e,f){var a=this._wrap;return V.map(V(V.isArray(a)?a.join(""):a).filter(e||"*"),function(b){return f?b.innerText||b.textContent:b.outerHTML||D(b);});}function C(){var a=this.nodes;V.tmpl(null,null,null,this).insertBefore(a[0]);V(a).remove();}})(jQuery);(function(c){var b=function(d,e){this.$elem=d;this.options=e;};b.prototype.selectPage=function(d){this.options.currentPage=d;this.render();};b.prototype.renderData=function(){var h=this.options;h.recordCount=parseInt(h.recordCount,10);h.currentPage=parseInt(h.currentPage,10);var f=[];var k=Math.floor(h.recordCount/h.pageSize)+(h.recordCount%h.pageSize==0?0:1);var e=false;var d=false;h.pageCount=k;for(var g=1;g<=k;g++){var j={type:"page",no:g};if(g==h.currentPage){j.type="curr";}if(h.dispOmi){if(g<h.currentPage-h.dispNum){if(g==1){}else{if(!e){j.type="omission";j.no=null;e=true;}else{continue;}}}if(g>h.currentPage+h.dispNum){if(g==k){}else{if(!d){j.type="omission";j.no=null;d=true;}else{continue;}}}}f.push(j);}return c.extend({pages:f},h);};b.prototype.bind=function(){var d=this;var e=this.options;this.$elem.find("[data-pager-pageno]").click(function(){var f=c(this).attr("data-pager-pageno");d.selectPage(parseInt(f,10));if(e.on&&e.on.select){e.on.select.call(d,f);}return false;});this.$elem.find("[data-pager-link]").click(function(){var g=c(this).attr("data-pager-link");switch(g){case"first":var f=1;break;case"prev":var f=e.currentPage-1;break;case"next":var f=e.currentPage+1;break;case"last":var f=e.pageCount;break;}d.selectPage(parseInt(f,10));if(e.on&&e.on.select){e.on.select.call(d,f);}return false;});this.$elem.find("[data-pager-link]").each(function(){var f=c(this).attr("data-pager-link");switch(f){case"first":if(e.currentPage>1){c(this).show();}else{c(this).hide();}break;case"prev":if(e.currentPage-1>=1){c(this).show();}else{c(this).hide();}break;case"next":if(e.currentPage+1<=e.pageCount){c(this).show();}else{c(this).hide();}break;case"last":if(e.currentPage<e.pageCount){c(this).show();}else{c(this).hide();}break;}if(e.buttons&&e.buttons[f]==false){c(this).hide();}});};b.prototype.render=function(){var e=this.$elem;var f=this.options;if(!f.recordCount){return;}e.empty();this.curData=this.renderData();if(f.tmpl&&f.tmpl.tmpl){f.tmpl.tmpl(this.curData).appendTo(e);}else{var d=c.template(null,a);c.tmpl(d,this.curData).appendTo(e);}this.bind();};var a='    <div class="pager">        <a href="#" data-pager-link="first">第一页</a>        <a class="prev" href="#" data-pager-link="prev">上一页</a>        {{each(idx,page) pages}}            {{if page.type == "page"}}            <a href="#" data-pager-pageno="${page.no}">${page.no}</a>               {{/if}}            {{if page.type == "curr"}}            <span class="current">${page.no}</span>            {{/if}}            {{if page.type == "omission"}}            ...            {{/if}}        {{/each}}        <a class="next" href="#" data-pager-link="next">下一页</a>        <a href="#" data-pager-link="last">最后一页</a>    </div>';jQuery.fn.pager=function(d){d=c.extend({currentPage:1,pageSize:10,dispNum:5,dispOmi:true},d||{});return c(this).each(function(){var f=this;var g=c(this);var e=new b(c(this),d);g.data("pager",e);e.render();});};})(jQuery);(function(){function a(b){this.opts=$.extend({SHOW_OTHER_MONTH:false,DAYS_HEADER:[1,2,3,4,5,6,0],cache:false,key:"ym",type:"json",dataKey:"content"},b);}a.prototype={init:function(){$(this).one("q-format-data",function(c,b){$(this).trigger("q-finish-data",[b]);});this._format();},prev:function(){var b=this.opts.currentDay;this.opts.currentDay=new Date(b.getFullYear(),b.getMonth()-1,1);this.init();},next:function(){var b=this.opts.currentDay;this.opts.currentDay=new Date(b.getFullYear(),b.getMonth()+1,1);this.init();},_format:function(){var b=this;$(this).one("q-merge-data",function(d,c){if(!b.opts.SHOW_OTHER_MONTH){$.each(c,function(e,f){$.each(f,function(i,k){var h=b.getMonth(k.date);var g=b.getMonth();if(h!==g){k.other_month=true;}});});}$(b).trigger("q-format-data",[c]);});this._merge();},getMonth:function(b){var e;if(b){e=b;}else{e=this.opts.currentDay;}var c=DateUtil.format(e);c=c.substring(0,7);return c;},_formatURL:function(){var c=this.opts.url;var b=this.opts.currentDay;var e=this.getMonth();var d="?";if(c.indexOf(d)>-1){d="&";}c=c+d+"pId="+this.opts.pId;c=c+"&"+this.opts.key+"="+e;return c;},_cache:{},_getList:function(){var d=[];var b=this;var c=this._formatURL();if(this._cache[c]){$(this).trigger("q-ajax-data",[this.copyData(this._cache[c])]);}else{$.ajax({url:c,dataType:this.opts.type,success:function(e){if(e&&e.data){d=e.data[b.opts.dataKey];if(b.opts.cache){b._cache[c]=b.copyData(d);}$(b).trigger("q-ajax-data",[d]);}}});}},copyData:function(c){var b=[];$.each(c,function(){b.push($.extend({},this));});return b;},_merge:function(){var b=[];$(this).one("q-ajax-data",function(f,d){b=d;var c=this._getTabel();if(!b.length){$(this).trigger("q-merge-data",[c]);}else{$.each(c,function(e,g){$.each(g,function(h,i){$.each(b,function(j,l){var k=DateUtil.format(i.date);if(k===l.date){l.date=DateUtil.parse(l.date);$.extend(i,l);}});});});$(this).trigger("q-merge-data",[c]);}});this._getList();},_getTabel:function(){var c=this.opts;var b=[];var d=new CalendarCore({currentDay:c.currentDay,DAYS_HEADER:c.DAYS_HEADER});$(d).one("refreshed",function(e,f){b=f;});d.refresh();return b;}};window.InventoryClass=a;})();if(typeof QNR=="undefined"){var QNR={};}QNR.InventoryCalendar=function(){var a=function(b){this.opts=$.extend({DAYS_HEADER:[1,2,3,4,5,6,0],DAYS_HEADER_TEXT:["一","二","三","四","五","六","日"],currentDay:DateUtil.today(),minDay:DateUtil.today(),maxDay:false,onrendered:function(){},cache:false,clickcancel:true,activeClass:"yellow"},b);this.Inventory=new InventoryClass(this.opts);this.init();};$.extend(a.prototype,{init:function(){this.Inventory.init();$(this.Inventory).bind("q-finish-data",$.proxy(function(c,b){this.render(b);this.bindEvents();this.opts.onrendered.call(this);},this));},render:function(b){this._renderTitle();this._renderTable(b);},_renderTitle:function(){if(this.title){this.title.remove();}var d=[];d.push('<h3 class="date"><a href="javascript:void(0)" class="pre_month" placeholder="prev"></a>');d.push('<span placeholder="current"></span><span class="a_blue" style="display: none" placeholder="allcheck">全选<input type="checkbox" /></span>');d.push('<a href="javascript:void(0)" class="next_month" placeholder="next"></a></h3>');this.title=$(d.join(""));var g=this.getMonth();var b=parseInt(g.split("-")[1],10);this.title.find('[placeholder="current"]').html(g.replace("-","年")+"月");var e=this.opts.minDay.getFullYear().toString()+this.opts.minDay.getMonth().toString();var c=this.opts.maxDay.getFullYear().toString()+this.opts.maxDay.getMonth().toString();var f=this.getMaxDay().getFullYear().toString()+this.getMaxDay().getMonth().toString();if(this.opts.sings_hide&&e.indexOf(f)!=-1){this.title.find('[placeholder="prev"]').hide();}else{this.title.find('[placeholder="prev"]').html(((b+10)%12+1)+"月");}if(this.opts.sings_hide&&c.indexOf(f)!=-1){this.title.find('[placeholder="next"]').hide();}else{this.title.find('[placeholder="next"]').html((b%12+1)+"月");}this.opts.parent.append(this.title);},_renderTable:function(h){this.data={};this.dataIndex={};if(this.table){this.table.remove();}var k,b,e=[];e.push('<table class="calendar_date">');e.push("<thead><tr>");for(var d=0;d<this.opts.DAYS_HEADER_TEXT.length;d++){if(this.opts.DAYS_HEADER[d]<6&&this.opts.DAYS_HEADER[d]>0){e.push('<th class="col">');}else{if(this.opts.DAYS_HEADER[d]==0){e.push('<th class="weekday">');}else{e.push('<th class="weekday saturday">');}}e.push('<div class="box"><p class="clr_after"><span class="week">'+this.opts.DAYS_HEADER_TEXT[d]+'</span><span class="_checkrows select_box" style="display:none"><input type="checkbox"></span></p></div>');e.push("</th>");}e.push("</tr></thead>");e.push("<tbody>");for(var d=0;d<h.length;d++){k=h[d];e.push("<tr>");for(var c=0;c<k.length;c++){b=k[c];if(b.other_month){e.push('<td class="k_day">');}else{if(((!this.opts.minDay)||b.date>=this.opts.minDay)&&((!this.opts.maxDay)||b.date<=this.opts.maxDay)){if(this.opts.sings_price&&(typeof b.price==="undefined")){e.push('<td class="gray">');}else{var f=this.opts.currentDay.getFullYear().toString()+(this.opts.currentDay.getMonth()+1).toString();if(this.opts.currentDay.getDate().toString()<=9){f+=0+this.opts.currentDay.getDate().toString();}else{f+=this.opts.currentDay.getDate().toString();}var g=b.date.getFullYear().toString()+(b.date.getMonth()+1).toString();if(b.date.getDate().toString()<=9){g+=0+b.date.getDate().toString();}else{g+=b.date.getDate().toString();}if(this.opts.sings_price&&g<f){e.push('<td class="gray">');}else{e.push('<td date="'+DateUtil.format(b.date)+'">');}}}else{e.push('<td class="gray">');}}e.push('<div class="tdbox">');e.push(this.opts.render(b));e.push("</div>");this.data[DateUtil.format(b.date)]=b;this.dataIndex[DateUtil.format(b.date)]=[d,c];e.push("</td>");}e.push("</tr>");}e.push("</tbody>");e.push("</table>");this.table=$(e.join(""));this.opts.parent.append(this.table);},getCell:function(b){b=DateUtil.format(DateUtil.parse(b));if(this.dataIndex[b]){return this.table.find("td:eq("+(this.dataIndex[b][0]*7+this.dataIndex[b][1])+")");}else{return false;}},bindEvents:function(){var b=this;this.table.find("tbody td[date]").bind("click",function(){b._click($(this));});this.table.find("tbody td[date]").bind("mousedown",function(c){c.preventDefault();});this.table.find("thead th").each(function(d,c){$(this).find(":checkbox").bind("click",function(){b.checkcols(d,this.checked);});});this.title.find('[placeholder="prev"]').bind("click",$.proxy(this.prev,this));this.title.find('[placeholder="next"]').bind("click",$.proxy(this.next,this));this.title.find(":checkbox").bind("click",function(){if(this.checked){b.checkAll();}else{b.clearAll();}});this.readCache();if(this.multi){this.multi=false;this.changeMode();}},_click:function(b){if(this.multi){if(b.hasClass(this.opts.activeClass)){if(this.opts.clickcancel){b.removeClass(this.opts.activeClass);}}else{b.addClass(this.opts.activeClass);}this.checkMulti();this._updateAllCheck();}else{if(b.hasClass(this.opts.activeClass)){if(this.opts.clickcancel){b.removeClass(this.opts.activeClass);}if(this.opts.sings){b.addClass(this.opts.activeClass);}}else{this.table.find("."+this.opts.activeClass).removeClass(this.opts.activeClass);b.addClass(this.opts.activeClass);}}if(this.opts.handler){this.opts.handler.call(this.table.find("."+this.opts.activeClass),this.checklist());}},changeMode:function(){this.multi=!this.multi;if(this.multi){this.table.find("thead :checkbox").attr("checked",false);this.title.find('[placeholder="allcheck"] :checkbox').attr("checked",false);this.table.find("thead .select_box").show();this.title.find('[placeholder="allcheck"]').show();}else{this.table.find("thead .select_box").hide();this.title.find('[placeholder="allcheck"]').hide();this.clearAll();}},multi:false,cache:[],readCache:function(){if(!this.cache.length){return;}var c=[];for(var b=0;b<this.cache.length;b++){c.push('[date="'+this.cache[b]+'"]');}this.table.find(c.join(",")).addClass(this.opts.activeClass);this.cache=[];if(this.opts.handler){this.opts.handler(this.checklist());}},checklist:function(){var b=[];this.table.find("."+this.opts.activeClass).each($.proxy(function(d,c){b.push(this.data[$(c).attr("date")]);},this));return b;},checkMulti:function(){this.table.find("thead :checkbox").each($.proxy(function(c,b){if(b.checked&&!this._checkedcols(c)){$(b).attr("checked",false);}},this));},checkcols:function(b,c){if(this._checkedcols(b)==c){return;}if(c){this.table.find("tbody tr").find("td:eq("+b+")").each(function(){if($(this).attr("date")){$(this).addClass(this.opts.activeClass);}});}else{this.table.find("tbody tr").find("td:eq("+b+")").removeClass(this.opts.activeClass);}this._updateAllCheck();if(this.opts.handler){this.opts.handler(this.checklist());}},_checkedcols:function(d){if(isNaN(d)||d<0||d>6){return false;}var c=parseInt(d,10);var b=this.table.find("tbody tr").find("td:eq("+c+")");for(var d=0;d<b.length;d++){if($(b[d]).attr("date")&&(!$(b[d]).hasClass(this.opts.activeClass))){return false;}}return true;},_updateAllCheck:function(){if(this.multi&&this.title.find(":checkbox").attr("checked")){this.title.find(":checkbox").attr("checked",this.isAllChecked());}},reload:function(){this.cache=[];this.table.find("."+this.opts.activeClass).each($.proxy(function(c,b){this.cache.push($(b).attr("date"));},this));this.Inventory.init();},next:function(){if(!this.opts.maxDay||(this.opts.maxDay&&this.opts.maxDay>this.getMaxDay())){this.Inventory.next();}},prev:function(){if(this.opts.minDay<this.getMinDay()){this.Inventory.prev();}},getMonth:function(){return this.Inventory.getMonth();},setMonth:function(b){this.Inventory.opts.currentDay=DateUtil.parse(b+"-01");this.Inventory.init();},getMinDay:function(){return DateUtil.parse(this.Inventory.getMonth()+"-01");},getMaxDay:function(){return new Date(DateUtil.getLastByMonth(DateUtil.parse(this.Inventory.getMonth()+"-01")).valueOf()+DateUtil.oneday-1);},checkAll:function(){if(this.multi){this.table.find("tbody td[date]").addClass(this.opts.activeClass);this.table.find("thead :checkbox").attr("checked",true);if(this.opts.handler){this.opts.handler(this.checklist());}}},clearAll:function(){this.table.find("tbody td[date]").removeClass(this.opts.activeClass);this.table.find("thead :checkbox").attr("checked",false);this.title.find(":checkbox").attr("checked",false);if(this.opts.handler){this.opts.handler(this.checklist());}},isAllChecked:function(){return this.table.find("tbody td[date]").length==this.table.find("tbody td[date]."+this.opts.activeClass).length;}});return a;}();(function(a){function b(c,d){this.el=c;this.$el=a(c);this.DATA={};this.PAGE_SIZE=8;this.CURRENT_PKG_ID=null;this.ajaxParams=d||{};}b.prototype={init:function(){this.$el.empty();this.$list=a("<div></div>");this.$pager=a("<div></div>");this.$el.append(this.$list);this.$el.append(this.$pager);},changePackageID:function(c){this.CURRENT_PKG_ID=c;if(this._getData()){this._renderAll();}else{this._fetchRoomInfo();}},_fetchRoomInfo:function(){var c=this;a.getJSON("/ajax/hms.php?action=get_package_room_list",a.extend({package_id:this.CURRENT_PKG_ID,n:Math.random()},this.ajaxParams),function(d){c.DATA[c.CURRENT_PKG_ID]=d.data.data;c._renderAll();});},_getTotal:function(){return this.DATA[this.CURRENT_PKG_ID]?this.DATA[this.CURRENT_PKG_ID]["total"]:0;},_getData:function(){if(this.DATA[this.CURRENT_PKG_ID]){return this.DATA[this.CURRENT_PKG_ID]["data"]||[];}else{return null;}},_renderAll:function(){this.$list.empty();this.$pager.empty();if(this._getData()&&this._getData().length){this._render_pager();this._render(1,this.PAGE_SIZE);a(this).trigger("hasData");}else{a(this).trigger("empty");}},_render_pager:function(){var c=this;this.$pager.pager({recordCount:this._getTotal(),pageSize:this.PAGE_SIZE,on:{select:function(d){c._render(d,c.PAGE_SIZE);}}});},_render:function(d,c){var e=this;var h=this.$list;var f=[];var j=this._getData().slice((d-1)*c,d*c);f.push('<table class="hotel_group_table" width="100%" class="table1" border="0">');f.push("    <tbody>");f.push("<tr>");f.push('    <th width="120"><div class="hgt_p1">城市</div></th>');f.push('    <th width="270"><div class="hgt_p1">酒店名称</div></th>');f.push('    <th width="150"><div class="hgt_p1">房型</div></th>');f.push('    <th width="70"><div class="hgt_p1">价格</div></th>');f.push('    <th width="130"><div class="hgt_p1">床型</div></th>');f.push('    <th width="130"><div class="hgt_p1">入住日期</div></th>');f.push('    <th width="60"><div class="hgt_p1">间夜</div></th>');f.push("</tr>");for(var g=0;g<j.length;g++){var k=j[g];f.push('    <tr ri-type="'+g+'">');f.push('		<td><div class="hgt_p1">'+k.city+"</div></td>");f.push('		<td><div class="hgt_p1">'+k.hotelName+"</div></td>");f.push('		<td><div class="hgt_p1">'+k.roomType+"</div></td>");f.push('		<td><div class="hgt_p1">&yen;'+k.room_price+"</div></td>");f.push('		<td><div class="hgt_p1">'+k.bedType+"</div></td>");f.push('		<td><div class="hgt_p1">'+(k.startDate||"").replace(" 00:00:00","")+"</div></td>");f.push('		<td><div class="hgt_p1">'+k.days+"</div></td>");f.push("	</tr>");}f.push("         </table>");h.empty().html(f.join(""));}};a.fn.RoomInfoDetail=function(c){var e=a(this).data("RoomInfoDetail");if(!e){e=new b(this,c);e.init();a(this).data("RoomInfoDetail",e);}return e;};})(jQuery);(function(a){if(!a){a=window.QNR={};}a.roomstat=function(){var c,f,j=$("#calendar_body"),h,d,e,b,g,i;return{init:function(){h=$("#roomstat_seq_first").attr("seq");d=$("#roomstat_roomtype").find("li:gt(0)").first().html();e=$("#calendar_detail").attr("fromdate");g=DateUtil.parse(e).getTime();b=$("#calendar_detail").attr("todate");i=DateUtil.parse(b).getTime();c=new CalendarCore(new Date(e));a.roomstat.push();$("#roomstat_seq_first").click(function(){$("#roomstat_seq_ul").toggle();});$("#roomstat_seq_ul").find("a").each(function(){var m=$(this);m.click(function(n){n.preventDefault();$("#roomstat_seq_first").html(m.html());$("#roomstat_seq_ul").hide();h=m.attr("seq");a.roomstat.push();});});var l=$("#roomstat_roomtype").find("li:gt(0)");l.each(function(){var m=$(this);m.click(function(n){n.preventDefault();l.removeClass("active");m.addClass("active");d=m.html();a.roomstat.push();});});var k=$("#roomstat_year_list").find("dd");k.each(function(m){var n=$(this);n.click(function(o){o.preventDefault();k.removeClass("active");n.addClass("active");e=m==0?$("#calendar_detail").attr("fromdate"):n.attr("date");a.roomstat.push();});});},push:function(){try{$(c).unbind("refreshed");$(c).bind("refreshed",function(n,o){var m=Math.max(o[0][0].date.getTime(),g);var p=Math.min(o[5][6].date.getTime(),i);e=DateUtil.format(new Date(m));b=DateUtil.format(new Date(p));var l="http://hms.qunar.com/api/group/roomStatEx?seq="+h+"&roomTypes="+encodeURIComponent(d)+"&from="+e+"&to="+b+"&callback=?";$.getJSON(l,function(t){f=t;var s="",q=-1;$.each(o,function(){var r=this;s+=($.map(r,function(A,v){var y=A.date.getDate(),B=A.date.getTime();if(f.ret){if(B>=m&&B<=p){var x=f.data.rooms[0].states;var z=[],w=[],u=[];$.each(x,function(C,D){z.push(D==0?"满房":((D==1)?"房量紧张":((D==2)?"畅订":"")));w.push(D==0?"gray_bg":((D==1)?"br_bg":((D==2)?"gr_bg":"")));u.push(D==0?"s1":((D==1)?"s2":((D==2)?"s3":"")));});q++;return((v==0||(v>6&&v%6==1))?"<tr>":"")+'<td class="'+w[q]+'">                                                         <div class="day">'+y+'</div>                                                         <div class="roomcount">                                                             <span class="'+u[q]+'">'+z[q]+"</span>                                                         </div>                                                    </td>"+((v!=0&&v%6==0)?"</tr>":"");}}return((v==0||(v>6&&v%6==1))?"<tr>":"")+'<td class="gray_bg">                                                 <div class="day">'+y+'</div>                                                 <div class="roomcount">&nbsp;</div>                                            </td>'+((v!=0&&v%6==0)?"</tr>":"");}).join(""));});j.html(s);});});c.changeDay(e);}catch(k){return;}}};}();$(function(){if($("#calendar_body").length){a.roomstat.init();}});})(QNR);(function(){function a(d){this.opts=$.extend({DAYS_HEADER:[1,2,3,4,5,6,0],container:".tts_calendar",isOverLayer:true},d);this.opts.staticDay=this.opts.day;this.map={};var e=new CalendarCore({currentDay:this.opts.day,DAYS_HEADER:this.opts.DAYS_HEADER});this.calendar=e;var b=this;$(b.calendar).bind("refreshed",function(c,f){b.result=f;});}a.prototype.init=function(){this.calendar.refresh();this._init();};a.prototype.next=function(){if(this.opts.maxDay){var b=this.opts.maxDay;var c=DateUtil.getFirstByMonth(DateUtil.addDay(DateUtil.getLastByMonth(this.opts.day),1)).getTime();if(c>b){return false;}}this.calendar.nextMonth();this.opts.day=this.calendar.opts.currentDay;this._init();};a.prototype.prev=function(){if(this.opts.minDay){var c=this.opts.minDay;var b=DateUtil.getLastByMonth(DateUtil.addDay(DateUtil.getFirstByMonth(this.opts.day),-1)).getTime();if(b<c){return false;}}this.calendar.prevMonth();this.opts.day=this.calendar.opts.currentDay;this._init();};a.prototype._init=function(){this.result=this._doCalendarData();this._getData();};a.prototype._doCalendarData=function(){var b=this.result;$(b[0]).each(function(){if(this.date.getDate()>7){this.otherMonth=true;this.cls="k_day";}});$(b[b.length-2]).each(function(){if(this.date.getDate()<13){this.otherMonth=true;this.cls="k_day";}});$(b[b.length-1]).each(function(){if(this.date.getDate()<13){this.otherMonth=true;this.cls="k_day";}});return b;};a.prototype.show=function(){var c=$(window).height(),b=this,d=$(this.opts.container).height();if(b.opts.isOverLayer){$(".js_loading").show().height($("body").height());}else{$(".js_loading").hide();}$(this.opts.container).show().css("top",((c-d)/2)+$(window).scrollTop()+"px");};a.prototype._bind=function(){var b=this;$(b).bind("renderComplete",function(){b.show();$(".js_calendar_hearder").undelegate();$(".js_calendar_hearder").delegate(".pre","click",function(){b.prev();});$(".js_calendar_hearder").delegate(".next","click",function(){b.next();});});};a.prototype._getData=function(){var b=this;var c=b.opts.url;var d=b.opts.pId;var e=[b.opts.day.getFullYear()];e.push(b.opts.day.getMonth()+1);e=e.join("-");c="http://p.tuan.qunar.com/order/productTeam.do";var f=c+"?pId="+d+"&month="+e+"&callback=?";$.getJSON(f,function(h){if(h.ret){var g=b._doProductData(h.data.team);b._drawCalendar(g);}else{return false;}});};a.prototype._doProductData=function(b){$.each(b,function(){var c=this;if(c.only==0){c.status="已售完";}else{if(c.only<11){c.status="紧张";}else{if(c.only>11){c.status="充足";}else{c.status="";}}}});return b;};a.prototype._drawCalendar=function(h){var c=this._drawHeader();var b=this.opts.container;var f=this._mergeData(h);var e=this._drawTable(f);$(b).find(".js_calendar_hearder").html(c.join(""));$(b).find(".js_calendar_tbody").html(e.join(""));this._bind();var g=this.map;$(this).trigger("renderComplete",g);};a.prototype._mergeData=function(h){try{var f=h;if(!f.length){return this.result;}else{var b=this.result;var c=this.opts.staticDay;$.each(b,function(d,e){$.each(e,function(i,k){if(!k.otherMonth){k.cls="";$.each(f,function(j,l){var m=DateUtil.format(k.date);if(m===l.date){l.date=DateUtil.parse(l.date);l.cls="pink";$.extend(k,l);}if(c.getTime()===k.date.getTime()){k.selected=true;k.cls="active";}});}});});return b;}}catch(g){}};a.prototype._drawHeader=function(){var b=this.opts.day;var c=[];var e=b.getFullYear();var f=b.getMonth()+1;var g=f-1;var d=f+1;if(f===1){g=12;}if(f===12){d=1;}c.push('<div class="date_title"><span class="pre">'+g+"月</span>");c.push(e+"年"+f+"月");c.push('<span class="next">'+d+"月</span></div>");return c;};a.prototype._drawTable=function(e){var c=[];c.push("<tr>                                     ");c.push('<th scope="col">一</th>                  ');c.push('<th scope="col">二</th>                  ');c.push('<th scope="col">三</th>                  ');c.push('<th scope="col">四</th>                  ');c.push('<th scope="col">五</th>                  ');c.push('<th scope="col" class="weekday">六</th>  ');c.push('<th scope="col" class="weekday">日</th>  ');c.push("</tr>                                    ");var b=this;$.each(e,function(d,f){c.push("<tr>");$.each(f,function(i,k){var h=k.date.getDate();if(k.otherMonth){c.push('<td class="'+k.cls+'">'+h);}else{if(k.only){var g=DateUtil.format(k.date);c.push('<td data-desc="'+k.desc.toString()+'" data-teamId="'+k.tId+'" data-date="'+g+'" data-roomType="'+k.roomType+'" class="'+k.cls+'"><h4>'+h);b.map[g]=k.prices;}else{c.push('<td class="'+k.cls+'"><h4>'+h);}if(k.status){c.push('<span class="red">'+k.status+"</span>");}c.push("</h4>");if(k.only){c.push("<ul>");$.each(k.desc,function(){var j=this.split("|");if(j[1]==0){return false;}c.push("<li>");c.push(j[0]+'<em class="red">&yen;'+j[1]+"起</em></li>");});c.push("</ul>");}}c.push("</td>");});c.push("</tr>");});return c;};window.BigCalendar=a;})();(function(){var a={initCalendar:function(){var c=$("#pId").val();var d=$("#tuanid").val();function b(){var g=DateUtil.parse($("#this_date").val());var h=DateUtil.parse(min_day);var f=max_day;if(!!max_day){f=DateUtil.parse(max_day);}if(h>g){g=h;}if(QNR.team.type=="package-tts"){var e=new BigCalendar({day:g,pId:c,url:"http://p.tuan.qunar.com/order/productTeam.do",container:"#orderCalendar",minDay:h,maxDay:f});$(e).bind("renderComplete",function(i,j){$("#orderCalendar .js_calendar_tbody").undelegate().delegate("td.pink,td.active","click",function(){var l=$(this).attr("data-teamid");var k=$(this).attr("data-date");window.open("http://p.tuan.qunar.com/order/confirmOrder.jsp?pId="+c+"&tId="+l+"&tuanid="+d+"&date="+k+"&adultCount=1&childCount=0&roomCount=1&orderSource=tuan","_blank");});});e.init();}}if(c=="0"){return false;}else{if($("#this_date").val()){b();}}},initSlider:function(){$("#ppt_1").switchable({interval:5,autoplay:true,effect:"none",events:["hover"],circle:true,activeTriggerCls:"current",delay:0});if($("#ppt_2")){var b=$("#ppt_2").find("div.imgshow");b.each(function(){$(this).css("display","none");});$("#ppt_2").switchable({interval:5,effect:"none",events:["hover"],circle:true,activeTriggerCls:"current",delay:0});}var c=$("#maptt_tab").switchable({effect:"scrollx",step:1,viewportLen:5,activeTriggerCls:"current",circle:true});$(".prev").click(function(){c.data("switchables")[0].prev();});$(".next").click(function(){c.data("switchables")[0].next();});},initRemaintime:function(){var b=$("li.remaining_time");b.each(function(c){$(this).countdown({day:{ele:"b",style:""},hour:{ele:"b",style:""},minute:{ele:"b",style:""},second:{ele:"b",style:"",show:true},datadiff:parseInt($(this).attr("data-diff")),millisecond:{show:false}});});},initShare:function(){$(".share_tools span.hover").mouseenter(function(){$(this).addClass("on");}).mouseleave(function(){$(this).removeClass("on");});$(".share_tools a.msn").click(function(b){var c=$(this).data("itemid");X.alert({message:'<div class=\'c share_qq_msn\'><p><div class="qq_msn">MSN/QQ</div><div class="tip">复制如下内容通过MSN或QQ发送给好友：</div><input type="text" value="http://tuan.qunar.com/team.php?id='+c+'" /></p></div>'});b.preventDefault();return false;});},initBooking:function(){function b(c){$("[tab-type]").removeClass("on");$("[tab-type='"+c+"']").addClass("on");$("[button-type]").parent().hide();$("[button-type='"+c+"']").parent().show();$("[switch-type]").hide();$("[switch-type='"+c+"']").show();}$("[tab-type]").click(function(){b($(this).attr("tab-type"));});b("tuan");QNR.change_type=b;$("[button-type='book']").click(function(c){if(!$("#chkagree:checked").size()){X.alert({message:"请阅读并同意《去哪儿网酒店团购在线预订说明》",icon:"fail"});c.preventDefault();return false;}});},initPackage:function(){function b(f,e,c){$("a.on").removeClass("on");$(e).addClass("on");var d=$("#team_id").val();if($("#package_info_"+f).length){$("div.js_package_box").hide();$("#package_info_"+f).show();$("#choose_name").html($("#package_name_"+f).val());}else{$.ajax({type:"POST",url:"/ajax/hms.php?action=select_package",data:"package_id="+f,dataType:"json",success:function(h){$("div.js_package_box").hide();var g=(parseInt(c/3)+1)*3-1;if($("a.li_3").eq(g).length){$(h.box_html).attr("id","package_info_"+f).insertAfter($("a.li_3").eq(g));}else{$(h.box_html).attr("id","package_info_"+f).insertAfter($("a.li_3").eq($("a.li_3").length-1));}$("#choose_name").html(h.package_name);}});}$("#hms_tuan_button").attr("href","/team/buy.php?id="+d+"&pid="+f);$("#hms_book_button").attr("href","/hms/book_first.php?&in_track=hotelteam_online_icon&id="+d+"&pid="+f);}QNR.select_package=b;},initRoomInfo:function(){var b=$('[hms-type="roominfo"]');var c=b.RoomInfoDetail({team_id:$("#team_id").val()});$(c).bind("empty",function(){b.closest("section").hide();}).bind("hasData",function(){b.closest("section").show();});$("a[hms-package-id]").click(function(d){var e=$(this).attr("hms-package-id");if(e){c.changePackageID(""+e);}});$("a[hms-package-id]").eq(0).click();$("span#txtagree").click(function(d){X.bookingDialog();d.preventDefault();return false;});},initScenicDetail:function(){var b=$('[placeholder="scenictabs"]>li'),c=$('[placeholder="scenic"] > dl');b.bind("click",function(){c.hide();c.eq($(this).index()).show();b.removeClass("on");$(this).addClass("on");});$map=$("#map_fc"),_counter=1,ticketdom=$("<dd></dd>"),optimedom=$("<dd></dd>");c.find("a.map_link").bind("click",function(k){$this=$(this);k.preventDefault();var h=$this.attr("name");var l=$this.attr("phone");var m=$this.attr("addr");var j=$this.attr("optime");var n=$this.attr("ticket");var o=$this.attr("city");var d="http://api.map.baidu.com/staticimage?center="+encodeURIComponent(m)+"&markers="+encodeURIComponent(m)+"&width=730&height=400";var g="http://map.baidu.com/?newmap=1&ie=utf-8&s="+encodeURIComponent("s&wd="+m);$map.find(".js_name").html(h);$map.find(".js_addr").html(m);if(l){$map.find(".js_phone").html(l).show();}else{$map.find(".js_phone").hide();}if(n){$map.find(".js_addr").parent().append(ticketdom);ticketdom.html("门票价格："+n);}else{ticketdom.remove();}if(j){$map.find(".js_addr").parent().append(optimedom);optimedom.html("开放时间："+j);}else{optimedom.remove();}$map.find(".js_img").attr("src",d);$map.find(".js_baidu").attr("href",g);var f="map-id-"+(_counter++);$map.attr("id",f);var i=$map.outerHTML();$map.attr("id","map_fc");X.boxShow(i);$("#"+f+" .js_close").click(function(){X.boxClose();});});$('[placeholder="descarea"]').each(function(){var i=$(this);var g=$(this).find('[placeholder="descadd"]').remove().html();var e=i.find('[placeholder="descbutton"]').remove();var h=$(this).html();g=h+g;var d=function(){e.remove().removeClass("open_off").addClass("open").html("展开");i.html(h);i.append(e);e.bind("click",f);};var f=function(){e.remove().removeClass("open").addClass("open_off").html("收起");i.html(g);i.append(e);e.bind("click",d);};d();});},initTrips:function(){$('[placeholder="trip"]').each(function(){$this=$(this);var e=$this.find('[placeholder="expand"]');var f=$this.find('[placeholder="fold"]');var c=$this.find('[placeholder="more"]');var b=function(){c.hide();e.show();f.hide();};var d=function(){c.show();e.hide();f.show();};e.find("a").bind("click",d);f.bind("click",b);});},init:function(){try{this.initCalendar();this.initSlider();this.initRemaintime();this.initShare();this.initBooking();this.initPackage();this.initRoomInfo();this.initScenicDetail();this.initTrips();}catch(b){}}};$($.proxy(a.init,a));})();(function(a,c){var b=window;if(!a){a=b.QNR={};}a.recoplay=function(){var d=function(g,j){if(typeof g=="undefined"||g==null){return"";}var f,h=0,e=g.length;for(f=0;f<g.length;f++){h=((g.charCodeAt(f)>=0)&&(g.charCodeAt(f)<=255))?h+1:h+2;if(h>j){e=f;break;}}if(e==g.length||e<=2){return g;}return(g.substr(0,e)+"...");};return{init:function(){try{var f=$("#trvlprourl").val();if(!f){return;}$.ajax({url:f,async:true,cache:true,dataType:"json",success:function(l){if(l.ret&&l.data.length){var k=[];k.push('  <div class="ct relative">');k.push('    <div class="bluetitle">');k.push("        <h3>推荐玩法</h3>");k.push('        <h4><a target="_blank" href="'+l.more+'">更多精彩玩法</a></h4>');k.push("    </div>");k.push('    <ul class="d_play">');for(var h=0;h<l.data.length;h++){k.push('        <li class="cf">');k.push('          <div class="seq fL yahei f22">玩法'+(h+1)+"</div>");k.push('          <div class="info_a fL">');k.push('            <h2 class="t f14 bold"><a target="_blank" href="'+l.data[h].url+'">'+l.data[h].title+"</a></h2>");k.push('                <dl class="c cf">');k.push('                    <dt class="bold">推荐理由：</dt>');k.push('                    <dd title="'+l.data[h].desc+'">'+d(l.data[h].desc,95)+"</dd>");k.push("              </dl>");k.push('                <dl class="c1 cf">');k.push('                    <dt class="bold">热卖线路：</dt>');k.push("                <dd>");for(var e=0;e<l.data[h].hots.length;e++){k.push('            <p><a target="_blank" href="'+l.data[h].hots[e].url+'">'+d(l.data[h].hots[e].title,95)+"</a></p>");}k.push("                </dd>");k.push("                </dl>");k.push("          </div>");k.push('          <div class="info_b fL">');k.push('            <a class="box_b" target="_blank" href="'+l.data[h].url+'">');k.push('                <p class="btn_d1"></p>');k.push('                <p class="c555">共<span class="color_ff075b">'+l.data[h].rCount+"</span>条线路</p>");k.push("            </a>");k.push("          </div> ");k.push("        </li>");}k.push("    </ul>");k.push("</div>");$(".deatail_page").append(k.join(""));}},error:function(){console.log(arguments[1]+"推荐玩法网络请求失败！");}});}catch(g){return;}}};}();b.setTimeout(function(){a.recoplay.init();},500);})(QNR);(function(){var a=function(){var g=$("#dialog");var i=$(".js_add_shop");var e=$("#team_id").val();var h=0;var f=".tuan_sel_list";var d=false;var c=9999;var b=0;return{init:function(){this.initClick();this.initChooseOptions();},initVar:function(){e=$("#team_id").val();d=false;b=0;c=9999;},showFc:function(j){X.boxShow($(j).outerHTML());$(j).find(".js_close").click(function(){X.boxClose();a.initVar();});},addToshop:function(){if(!e){alert("找不到团品id！");return;}$.ajax({type:"GET",url:"/ajax/cart.php?act=add",data:"team_id="+e+(h?"&quantity="+h:""),dataType:"json",success:function(k){if(k.ok){var j=$(".js_addshop_suc");j.find(".js_num").html(k.info.quantity);j.find(".js_money").html(k.info.sum);a.showFc(".js_addshop_suc");QNR.idx_shop.showNum(k);}else{a.showFc(".js_addshop_fail");}}});},initClick:function(){i.click(function(){var j=$(this);if(j.attr("is_login")=="0"){if(!navigator.cookieEnabled){alert("浏览器对cookie做了限制，不能添加到购物车！");return;}}if(!j.attr("chooseoptions")){a.addToshop();}else{a.showFc(".js_team_attrsel");}});},checkNum:function(j){var k=/^[1-9][0-9]*$/;return k.test(j);},initChooseOptions:function(){if($(".js_team_attrsel").length){g.delegate(".js_sel_list","click",function(){var j=$(this);j.closest("ul").find("li").removeClass("active");j.addClass("active");e=$("#team_id").val();a.getChooseOptions();});g.delegate(".js_attrMaxNum","keyup",function(){var j=$(this);var k=j.val();if(!a.checkNum(k)&&$.trim(k)!=""){j.val(1);}});g.delegate(".js_attrMaxNum","blur",function(){var l=$(this);if(l.attr("readonly")){return;}if($.trim(l.val())==""){l.val(1);}var k=parseInt(l.val());if(k>c){l.val(c);k=c;}var j=b*k;g.find(".js_price").html(parseFloat(j).toFixed(2));});g.delegate(".js_submit","click",function(){var j=parseInt(g.find(".js_attrMaxNum").val());if(j<=c&&d){h=j;a.addToshop();}});}},getChooseOptions:function(){var k=[],j=[],m=0;g.find(".js_sel_list").each(function(){var n=$(this);if(n.hasClass("active")){k.push(encodeURIComponent(n.attr("data-key")+"=>"+n.attr("data-value")));j.push(n.attr("data-value"));m++;}});g.find(".js_select_options").html(j.join("&nbsp;|&nbsp;"));if(g.find(f).length!=m){return;}var l="/ajax/team.php?action=get_team_by_attr&team_id="+e+"&select_attr="+k.join(",");$.ajax({type:"GET",url:l,dataType:"json",success:function(p){try{if(p.error){g.find(".js_attrMaxNum").attr("readonly","readonly");!g.find(".js_no_options").length&&g.find(".js_select_options").parent().append('<span class="js_no_options">（没有此款）</span>');g.find(".js_attrMaxNum").val("");g.find(".js_maxnum").html("");d=false;}else{g.find(".js_no_options").length&&g.find(".js_no_options").remove();var n=p.data.data;b=parseFloat(n.price);c=parseInt(n.maxNum);if(c>0){g.find(".js_maxnum").html("（最多"+c+"件）");g.find(".js_attrMaxNum").attr("readonly","");g.find(".js_attrMaxNum").val(1);e=n.teamid;d=true;}else{g.find(".js_maxnum").html("（卖完了）");g.find(".js_attrMaxNum").attr("readonly","readonly");g.find(".js_attrMaxNum").val("");d=false;}g.find(".js_price").html(parseFloat(n.price).toFixed(2));}}catch(o){}},error:function(){alert("购买必选项接口出错！");}});}};}();$(function(){a.init();});})();$(function(){var a={init:function(){if(!QNR.team||QNR.team.type!="package-tts-pack"||this.initElement.pId==0){return;}this.initDetails();this.initCalendar();this.initEvents();},initElement:{pId:$("#pId").val()},initDetails:function(){var b="http://p.tuan.qunar.com/tuan/productdetail.do?method=SearchProductDetail&pId=";this.strUrl(b+QNR.team.id);},initCalendar:function(){this.dialog=$('<div class="Calendar11_box_pop"><div class="Calendar11_box"><div class="Calendar11_box_hd"><span class="Calendar11_box_close" close="close">关闭</span></div><div class="Calendar11_title"></div></div></div>');this.tts_pack_dialog=$("body").prepend('<div id="holiday_package_calendar"></div>');this.tts_pack_dialog=$("#holiday_package_calendar").css({position:"absolute","z-index":"9999",display:"none",border:"4px solid #7D7D7D",background:"white",padding:"1px"});this.c_sings=false;var c=this.dialog.find(".Calendar11_title");var b=this.dialog.find(".Calendar11_box");this.calendar=new QNR.InventoryCalendar({pId:QNR.team.id,url:"http://p.tuan.qunar.com/order/packageTeam.do?opType=monthPrices",parent:b,minDay:DateUtil.parse(QNR.team.minDay),currentDay:new Date(),maxDay:DateUtil.parse(QNR.team.maxDay),type:"jsonp",dataKey:"content",sings:true,sings_hide:true,sings_price:true,render:function(g){var e=this.currentDay.getFullYear().toString()+(this.currentDay.getMonth()+1).toString();if(this.currentDay.getDate().toString()<=9){e+=0+this.currentDay.getDate().toString();}else{e+=this.currentDay.getDate().toString();}var f=g.date.getFullYear().toString()+(g.date.getMonth()+1).toString();if(g.date.getDate().toString()<=9){f+=0+g.date.getDate().toString();}else{f+=g.date.getDate().toString();}if(g.price&&(g.date.getTime()>=this.minDay.getTime()&&g.date.getTime()<=this.maxDay.getTime())&&f>=e){var d=[];d.push('<div class="tdbox_1" cursor="pointer">'+g.date.getDate()+"</div>");d.push('<div class="tdbox_22">'+g.roomMax+"/"+g.inventory+"</div>");d.push('<div class="tdbox_33">');d.push('<p class="qunar_price">&yen;'+g.price+"</p></div>");return d.join("");}else{return'<div class="tdbox_1">'+g.date.getDate()+"</div>";}},handler:function(e){if(typeof e[0].price==="undefined"){return;}var d=$(this).attr("date");window.open("http://p.tuan.qunar.com/order/confirmOrder.jsp?adult=1&date="+d+"&tuanid="+QNR.team.tuanid+"&pId="+QNR.team.id+"&room=1&orderSource=tuan");a.c_sings=true;a.tts_pack_dialog.hide();return;},onrendered:function(){c.html("");c.append(this.title.children());this.title.remove();this.table.attr("width","100%");this.table.find("td,th").attr("width","14%");this.table.find("td.gray>div").addClass("tdbox_no1");this.table.find("td.k_day>div").addClass("tdbox_no2");}});},initEvents:function(){var b=true;$('[placeholder="datepicker"]').bind("click",$.proxy(function(g){g.preventDefault();if(a.c_sings){a.tts_pack_dialog.show();b=false;}if(b){b=false;var i=$(window).height();var f=$(window).width()+$(window).scrollLeft();this.dialog.appendTo(a.tts_pack_dialog);var h=a.tts_pack_dialog.outerHeight();var d=a.tts_pack_dialog.outerWidth();var c=(f-d)/2;if($(window).scrollTop()==0&&i<h){a.tts_pack_dialog.css({top:"0px",left:c+"px"}).show();}else{var e=(i-h)/2+$(window).scrollTop();a.tts_pack_dialog.css({top:e+"px",left:c+"px"}).show();}}if($('[cursor="pointer"]').length){$('[cursor="pointer"]').each(function(){$(this).parent().css({cursor:"pointer"});});}},this));$('[close="close"]').live("click",$.proxy(function(c){c.preventDefault();a.tts_pack_dialog.hide();b=true;},this));},strUrl:function(b){var c=this;$.ajax({url:b,dataType:"jsonp",type:"GET",success:function(f){if(f.ret==1){if(f.data.flightdetail==""||typeof f.data.flightdetail==="undefined"){return;}var d=f.data.flightdetail;c.flight(d);$("#flight[show='true']").show();if(f.data.hoteldetail==""||typeof f.data.hoteldetail==="undefined"){return;}var e=f.data.hoteldetail;c.hoteldetail(e);$("#hotel[show='true']").show();}else{return;}},error:function(d){return;}});},flight:function(c){var b=$("#flight");$.each(c,function(e){var d=['<table cellpadding="0" cellspacing="0" width="100%">'];d.push('<tr><td width="106" rowspan="2"><div class="f_package_num"><p>航班套餐</p><b>'+c[e].solution+"</b></div> </td>");d.push('<td colspan="2"><table cellpadding="0" cellspacing="0"  width="100%"><tr class="f_package_title"><th width="65">航程</th><th width="64">航段</th><th width="150">起抵时间</th><th width="248">航段</th><th width="150">航空公司</th> <th class="aC">差价</th> </tr></table></td></tr>');d.push('<tr><td width="678"><table cellpadding="0" cellspacing="0"  width="100%">');d.push('<tr><td width="65" class="aC"><b class="f14">去程</b></td><td colspan="4" class="bdt0">');$.each(c[e].goflight,function(h,g){var f=c[e].goflight[h].flight;d.push('<ul class="f_package_list  cf">');d.push('<li class="h1">'+c[e].goflight[h].seg+"</li>");d.push('<li class="h2">'+f.depTime+"-"+f.arrTime);if(f.dayGap==null){d.push("</li>");}else{d.push("&nbsp;&nbsp;("+f.dayGap+")</li>");}d.push('<li class="h3"><p class="airport">'+f.depCity+'<span class="gray">'+f.depAirport+'</span></p><span class="airport_line">一</span><p class="airport">'+f.arrCity+'<span class="gray">'+f.arrAirport+"</span></p></li>");d.push('<li class="h4">'+f.flightNo+"</li>");d.push("</ul>");});d.push("</td></tr>");d.push('<tr class="top_solid_line"><td width="65" class="aC"><b class="f14">回程</b></td><td colspan="4" class="bdt0">');$.each(c[e].returnflight,function(g){var f=c[e].returnflight[g].flight;d.push('<ul class="f_package_list  cf">');d.push('<li class="h1">'+c[e].returnflight[g].seg+"</li>");d.push('<li class="h2">'+f.depTime+"-"+f.arrTime);if(f.dayGap==null){d.push("</li>");}else{d.push("&nbsp;&nbsp;("+f.dayGap+")</li>");}d.push('<li class="h3"><p class="airport">'+f.depCity+'<span class="gray">'+f.depAirport+'</span></p><span class="airport_line">一</span><p class="airport">'+f.arrCity+'<span class="gray">'+f.arrAirport+"</span></p></li>");d.push('<li class="h4">'+f.flightNo+"</li>");d.push("</ul>");});d.push("</td></tr>");d.push('</table></td><td width="184" class="aC">');c[e].price=c[e].price/100;if(c[e].price>0){d.push('<span class="orange">加<span class="gap5">&yen;</span><b class="font18">'+c[e].price+"</b></span></td></tr>");}if(c[e].price<0){c[e].price=c[e].price.toString().slice(1);d.push('<span class="orange">减<span class="gap5">&yen;</span><b class="font18">'+c[e].price+"</b></span></td></tr>");}if(c[e].price==0){d.push('<span class="orange">无</span></td></tr>');}d.push("</table>");b.append(d.join(""));});$("td.bdt0").each(function(){$(this).find("ul").first().addClass("ff_package_list");});},hoteldetail:function(f){var e=this;var g=$("#hotel");var b=$("#tab_btn");var c=$("#hoteldetail_content");var d=[];$.each(f,function(h){if(f[h].start_day==f[h].end_day){d.push("<li>第"+f[h].start_day+"天</li>");}else{d.push("<li>第"+f[h].start_day+"天&nbsp;&nbsp;-&nbsp;&nbsp;第"+f[h].end_day+"天</li>");}var i=['<table width="100%" cellpadding="0" cellspacing="0">'];$.each(f[h].hotel,function(j){var k=f[h].hotel[j];i.push('<tr><td width="106"><div class="f_package_num h_package_num"><p>可选酒店</p><b>'+(j+1)+'</b></div></td><td class="top_solid_line"><table width="100%" cellpadding="0" cellspacing="0" class="h_package_list"><tr>');i.push('<td width="678"><dl class="h_package_list"></dl><dt>');if(k.imgs.length>0){i.push('<img width="118" height="118" src="http://userimg.qunar.com/imgs/'+k.imgs[0]+'normal.jpg">');}else{i.push('<img width="118" height="118" src="http://source.qunar.com/site/images/travel/tts_qt/nopic_4.gif">');}i.push("</dt><dd><h5>"+k.hotelName+"</h5>");switch(k.hotelStar){case null:i.push("");break;default:i.push("<em>"+k.hotelStar+"</em>");}i.push(" <ul> <li><b>地标：</b>"+k.hotelPoi+"</li><li><b>地址：</b>"+k.address+"</li> <li><p>"+k.hotelDesc+'</p></li></ul></dd></td><td class="aC"><p class="lh_22">价差<br /><span class="orange">');k.price=k.price/100;if(k.price>0){i.push('<span class="orange">加<span class="gap5">&yen;</span><b class="font18">'+k.price+"</b></span></td></tr>");}if(k.price<0){k.price=k.price.toString().slice(1);i.push('<span class="orange">减<span class="gap5">&yen;</span><b class="font18">'+k.price+"</b></span></td></tr>");}if(k.price==0){i.push('<span class="orange">无</span></td></tr>');}i.push("</tr></table></td></tr>");});i.push("</table>");c.append(i.join(""));});b.append(d.join(""));b.find("li").first().addClass("active first");c.children("table").first().show().siblings().hide();b.find("li").live("click",function(h){e.ttsTab(h,c);});},ttsTab:function(d,b){var d=window.event||d;d=d.target||d.srcElement;$(d).addClass("active").siblings().removeClass("active");var c=$(d).index();b.children("table").eq(c).show().siblings().hide();}};a.init();});$(function(){var a={init:function(){if(typeof QNR.team==="undefined"||QNR.team.type!="package-tts-tickets"||this.initElement.pId==0){return;}this.initEvents_hover();this.initEvents_click();this.initDetails();},initElement:{pack_door:$('div[pack_door="pack_door"]'),tips_img:$('[tips_img="tips_img"]'),tips_div:$('[tips_div="tips_div"]'),doorlink:$('[doorlink="doorlink"]'),pId:$("#pId").val()},initEvents_hover:function(){this.initElement.tips_img.live({mouseenter:function(){$(this).parent().css({"z-index":"33"});$(this).next().show();},mouseleave:function(){$(this).parent().css({"z-index":"0"});$(this).next().hide();}});},initEvents_click:function(b){this.initElement.doorlink.live({click:function(c){$(this).toggle(function(){c.preventDefault();$(this).parents("tr").addClass("tts_ct_on").next('[show="show"]').show();},function(){c.preventDefault();$(this).parents("tr").removeClass("tts_ct_on").next('[show="show"]').hide();});}});},initDetails:function(){var b="http://p.tuan.qunar.com/tuan/productdetail.do?method=SearchProductDetail&pId=";this.strUrl(b+QNR.team.id);},strUrl:function(b){var c=this;$.ajax({url:b,type:"GET",dataType:"jsonp",success:function(d){if(d.ret==1){if(d.data.tickets==""||typeof d.data.tickets==="undefined"){return;}c.pack_door(d.data.tickets);c.initElement.pack_door.show();}else{return;}},error:function(){return;}});},pack_door:function(c){var b=['<table width="100%" class="tts_ct_table" border="0" cellspacing="0" cellpadding="0"><tr><th width="215" height="39" class="text_center"><b>门票类型</b></th><th width="175" height="39" class="text_center"><b>原价</b></th><th width="200" height="39" class="text_center"><b>售价</b></th> <th width="240" height="39" class="text_center"><b>有效期</b></th><th width="150" height="39" class="text_center"><b>说明</b></th></tr>'];$.each(c,function(d){b.push('<tr><td><p class="tts_ct_td1 f14"><b>'+c[d].title+'</b></p></td><td align="center">');c[d].market_price=c[d].market_price/100;b.push('<b class="del">¥<span class="f14">'+c[d].market_price+"</span></b>");b.push('</td><td><div class="tts_ct_td3">');if(c[d].qunar_price){c[d].qunar_price=c[d].qunar_price/100;b.push('<p class="cFF5400">成人价 ¥<b>'+c[d].qunar_price+"</b></p>");}if(c[d].child_price){c[d].child_price=c[d].child_price/100;b.push("<p>儿童价 ¥<b>"+c[d].child_price+"</b></p>");}if(c[d].other_price){c[d].other_price=c[d].other_price/100;b.push('<div class="tts_ct_tips tts_ct_tips_on" style="z-index:0">其他价 ¥<b>'+c[d].other_price+"</b>");if(c[d].description==null||c[d].description==""||typeof c[d].description==="undefined"){b.push("");}else{b.push('<i class="i_help" tips_img="tips_img"></i>');b.push('<div class="pop_ts absoute" style="display:none" tips_div="tips_div"><div class="pop_ts_ct"><s class="bot"></s><s class="top"></s><p>其它价说明：</p>'+c[d].description+"</div></div>");}b.push("</div>");}b.push('</div></td><td align="center"><p>'+c[d].beginDate+"至"+c[d].endDate+'</p></td><td align="center"><p>');b.push('<a href="'+c[d].buyUrl+"&tuanid="+QNR.team.tuanid+'" target="_blank" class="btn1 show">立即购买</a>');if((c[d].fee_description==""||typeof c[d].fee_description==="undefined"||c[d].fee_description==null)&&(c[d].use_description==""||typeof c[d].use_description==="undefined"||c[d].use_description==null)){b.push("</p></td></tr>");}else{b.push('<span class="tts_ct_action" doorlink="doorlink">查看详情</span></p></td></tr>');b.push('<tr class="tts_ct_on_list" style="display:none" show="show"><td colspan="5"><div class="tts_icon_uo"><s></s></div><div class="tts_ct_dl">');if(c[d].fee_description){b.push('<dl class="cf"><dt>费用说明</dt><dd>'+c[d].fee_description+"</dd></dl>");}if(c[d].use_description){b.push('<dl class="cf"><dt>使用说明</dt><dd>'+c[d].use_description+"</dd></dl>");}b.push("</div></td></tr>");}});b.push("</table");this.initElement.pack_door.append(b.join(""));$('[doorlink="doorlink"]').click();}};a.init();});